<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>加盟费返佣</title>
	<meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
	<meta name="format-detection" content="telephone=no">
	<link rel="stylesheet" href="css/fcds.css">
	<link rel="stylesheet" href="css/loader.css">
</head>
<body>

	<div class="loader_cover_box">
		<div class="loader">加载中...</div>
	</div>

  <div class="rebate">
      <div class="rebate-header" id="mDete"><!-- 2017年01月 --></div>
      <div class="rebate-list" id="container">
        <ul class="rebate-box" id="rebateList">
          <!-- <li>
            <div class="inner">
              <div class="item">
                <p>周一</p>
                <p>01-13</p>
              </div>
              <div class="item"> -->
                <!-- senior first_level -->
             <!--    <span class="rebate_user_img senior"></span>
              </div>
              <div class="item">周大富</div>
              <div class="item">100000</div>
            </div>
          </li>
          <li>
            <div class="inner">
              <div class="item">
                <p>周一</p>
                <p>01-13</p>
              </div>
              <div class="item"> -->
                <!-- senior first_level -->
          <!--       <span class="rebate_user_img first_level"></span>
              </div>
              <div class="item">周大富</div>
              <div class="item">100000</div>
            </div>
          </li>
          <li>
            <div class="inner">
              <div class="item">
                <p>周一</p>
                <p>01-13</p>
              </div>
              <div class="item"> -->
                <!-- senior first_level -->
            <!--     <span class="rebate_user_img senior"></span>
              </div>
              <div class="item">周大富</div>
              <div class="item">100000</div>
            </div>
          </li> -->
        </ul>
        <div class="dropload-down"><div class="dropload-load"><span class="loading"></span>加载中...</div></div>
      </div>
  </div>

  <p class="tips" id="tips">&nbsp;</p>

  <script src="js/jquery-1.8.3.min.js"></script>
  <script src="js/mo.js"></script>
  <script src="js/jquery.cookie.js"></script>
  <script src="js/common.js"></script>
  <script type="text/javascript">
    $(function(){
      $(".loader_cover_box").css("display","block");
      var totalPage = 0;
      var page = 0;
      var url=decodeURI(location.href);
      var month=url.split("?")[1];
      var session_token = $.cookie('session_token');
      app.ajaxHelper.submitRequest({
          url: '/api/findFranchiseRebateDetail',
          data: {
              session_token: session_token,
              month: month
          },
          success: function (data) {
              totalPage = data.data.paging.totalPage;
              var state = data.result;
              var emptyHtml = '<div class="empty_data"><div class="empty"></div></div>';
              $("#mDete").html(month);

              if (state == "success") {
                $(".loader_cover_box").css("display","none");
                  function detailedListHtml(date,week,tradeUserName,rebateAmount,brokerUserNo) {
                    var brokerNoLength = brokerUserNo.length;
                    var level = '';
                    if (brokerNoLength == 4) {
                        level = 'senior';
                    }else{
                      level = 'first_level';
                    }
                    var html = '<li><div class="inner"><div class="item"><p>'+week+'</p><p>'+date+'</p></div><div class="item"><span class="rebate_user_img '+level+'"></span></div><div class="item">'+tradeUserName+'</div><div class="item">'+rebateAmount+'</div></div></li>';

                    return html;
                  }
                  $(data.data.rebateList).each(function(i){
                    var listHtml = detailedListHtml(this.date,this.week,this.tradeUserName,this.rebateAmount,this.brokerUserNo);
                    $('#rebateList').append(listHtml);
                  })
                  if(data.data.rebateList == ''){
                    $("#container").html(emptyHtml)
                  }
              } else if (state > "error") {
                  errors(emptyHtml);
              } else if (state < "noSession") {
                  $("#tip").html('<span class="tip_text">' + data.message + '</span>');
                  window.location.href = "login.html";
              }
          }
      })

        // 分页
      $(window).scroll(function(){
          var wh=$("#container").height();
          var s= wh - $(window).scrollTop() - $(window).height();
          if(s < 0 ){
            page++;
            // alert(totalPage +"---"+page)
            if(totalPage > page){
                $(".dropload-down").css("display","block");
                var session_token = $.cookie('session_token');
                var url=decodeURI(location.href);
                var month=url.split("?")[1];
                var pageIndex = page;
                app.ajaxHelper.submitRequest({
                    url: '/api/findFranchiseRebateDetail',
                    data: {
                        session_token: session_token,
                        month: month,
                        pageIndex: pageIndex
                    },
                    success: function (data) {
                        var state = data.result;
                        var emptyHtml = '<div class="empty_data"><div class="empty"></div></div>';
                        $("#mDete").html(month);

                        if (state == "success") {
                          $(".dropload-down").css("display","none");
                            function detailedListHtml(date,week,tradeUserName,rebateAmount,brokerUserNo) {
                              var brokerNoLength = brokerUserNo.length;
                              var level = '';
                              if (brokerNoLength == 4) {
                                  level = 'senior';
                              }else{
                                level = 'first_level';
                              }
                              var html = '<li><div class="inner"><div class="item"><p>'+week+'</p><p>'+date+'</p></div><div class="item"><span class="rebate_user_img '+level+'"></span></div><div class="item">'+tradeUserName+'</div><div class="item">'+rebateAmount+'</div></div></li>';

                              return html;
                            }
                            $(data.data.rebateList).each(function(i){
                              var listHtml = detailedListHtml(this.date,this.week,this.tradeUserName,this.rebateAmount,this.brokerUserNo);
                              $('#rebateList').append(listHtml);
                            })
                            if(data.data.rebateList == ''){
                              $("#container").html(emptyHtml)
                            }
                        } else if (state > "error") {
                            errors(emptyHtml);
                        } else if (state < "noSession") {
                            $("#tip").html('<span class="tip_text">' + data.message + '</span>');
                            window.location.href = "login.html";
                        }
                    }
                })
            }
          }
        });

        $(".loader_cover_box").on('touchmove', function(event) {
          event.preventDefault();
        });
    });
  </script>
</body>
</html>