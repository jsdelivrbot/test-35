<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>经纪商</title>
	<meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
	<meta name="format-detection" content="telephone=no">
	<link rel="stylesheet" href="css/fcds.css">
	<link rel="stylesheet" href="css/nav.css">
	<link rel="stylesheet" href="css/loader.css">
</head>
<body>

	<div class="loader_cover_box">
		<div class="loader">加载中...</div>
	</div>

	<div class="detailed_header">
		<div class="user_info_d" id="supervisorName"></div>
		<div class="search_box">
			<div class="search_inner">
				<div class="search">
					<div class="search_left"><input type="text" placeholder="请您输入高级经纪商账号或名称" id="searchInfo"></div>
				</div>
				<div class="inner_left or" id="search"><a href="javascript:;">查 询</a></div>
			</div>
		</div>
	</div>

	<div class="detailed_list" id="detailed_list">
		<div class="list list_1 cur" id="itemList" >
			<!-- <div class="item">
				<b class="d_grade senior"></b>
				<p class="user_ifon"><i class="user_name">王健林1</i><i class="user_adderss">广东省广州一市白云一区</i></p>
				<p><span class="user_account">经纪商账号：<i>4301</i></span><span class="user_num">结算账号：<i>4405020001</i></span></p>
				<p><span>开号日期：2016-11-24</span><span>手机号码：18576854657</span></p>
				<p><span>开户总量：13</span><span>签约总量：12</span></p>
				<p><span>交易总量：98600</span></p>
				<b class="level_one" onclick="window.location='first_level.html?pic=4301'">一级经纪商</b>
			</div> -->
			<!-- <div class="empty_data"><div class="empty"></div></div> -->
		</div>

	</div>
	<div style="height:70px"></div>
	<p class="tips" id="tips">&nbsp;</p>
	<script src="js/jquery-1.8.3.min.js"></script>
	<script src="js/mo.js"></script>
    <script src="js/jquery.cookie.js"></script>
    <script src="js/common.js"></script>
	<script type="text/javascript">
		$(function() {    

			$(".loader_cover_box").css("display","block");
			var links = '<div class="Nav"><div class="navin"><ul><li class="curr" onclick="window.location = \'index.html\'"><a href="#" class="homebox"><i class="home"></i>首页</a></li><li ><a href="#" class="cartbox" onclick="window.location= \'senior_trading.html\'"><i class="shopcart"></i>交易量</a></li><li ><a href="#" class="comdybox" onclick="window.location= \'broker.html\'"><i class="comdy"></i>交易商</a></li></ul></div></div>'
			$("body").append(links);
		    var totalPage = 0;
		    var page = 0;
		    // 首页查询接口
	  		var session_token = $.cookie('session_token');
	        app.ajaxHelper.submitRequest({
	            url: '/api/listBrokerUserAdvance',
	            data: {
	                session_token: session_token
	            },
	            success: function (data) {
	                var state = data.result;
	                var emptyHtml = '<div class="empty_data"><div class="empty"></div></div>';
	                if (state == "success") {
	                   	totalPage = data.data.paging.totalPage;
                   		$(".loader_cover_box").css("display","none");
                   		$("#supervisorName").html(data.data.supervisorName);

       	                function detailedListHtml(name,brokerUserName,brokerUserNo,userNo,becomeBrokerDate,phone,accountOpenCount,accountSignCount,tradingVolume,diamondVipCount) {

       		                var html = '<div class="item"><b class="d_grade senior"></b><p class="user_ifon"><i class="user_name">'+name+'</i><i class="user_adderss">'+brokerUserName+'</i></p><p><span class="user_account">经纪商账号：<i>'+brokerUserNo+'</i></span><span class="user_num">结算账号：<i>'+userNo+'</i></span></p><p><span>开号日期：'+becomeBrokerDate+'</span><span>手机号码：'+phone+'</span></p><p><span>开户总量：'+accountOpenCount+'</span><span>签约总量：'+accountSignCount+'</span></p><p><span>交易总量：'+tradingVolume+'</span><span>钻石VIP：'+diamondVipCount+'</span></p><p><span>&nbsp;</span></p><b class="level_one vip" onclick="window.location= \'vip.html?brokerUserNo='+brokerUserNo+'\'">查看钻石VIP</b><b class="level_one" onclick="window.location= \'first_level.html?pic='+brokerUserNo+'\'">一级经纪商</b></div>';

       		                return html;
       	                }

       	                $(data.data.brokerList).each(function(i){
       	                	var listHtml = detailedListHtml(this.name,this.brokerUserName,this.brokerUserNo,this.userNo,this.becomeBrokerDate,this.phone,this.accountOpenCount,this.accountSignCount,this.tradingVolume,this.diamondVipCount);
       	                	$('#itemList').append(listHtml);
       	                })

	                } else if (state > "error") {
	                    $('#itemList').html(emptyHtml)
	                } else if (state < "noSession") {
	                    window.location.href = "login.html";
	                }
	            }
	        })

            // 收索请求
            $(document).on('click' , '#search' , function(){

            	$(".loader_cover_box").css("display","block");
            	page = 0;
	        	var session_token = $.cookie('session_token');
	        	var brokerUserNo = $("#searchInfo").val();
	        	var pageIndex = page;
              	app.ajaxHelper.submitRequest({
                  	url: '/api/listBrokerUserAdvance',
                  	data: {
                      	session_token: session_token,
                      	brokerUserNo: brokerUserNo,
                      	pageIndex: pageIndex
                  	},
                  	success: function (data) {
                      	var state = data.result;
                      	var emptyHtml = '<div class="empty_data"><div class="empty"></div></div>';
                      	if (state == "success") {
                      		totalPage = data.data.paging.totalPage;
                      		// alert(totalPage);
     	            		var itemListHtml = '';
     	            		$(".loader_cover_box").css("display","none");

     		                function detailedListHtml(name,brokerUserName,brokerUserNo,userNo,becomeBrokerDate,phone,accountOpenCount,accountSignCount,tradingVolume,diamondVipCount) {

     			                var html = '<div class="item"><b class="d_grade senior"></b><p class="user_ifon"><i class="user_name">'+name+'</i><i class="user_adderss">'+brokerUserName+'</i></p><p><span class="user_account">经纪商账号：<i>'+brokerUserNo+'</i></span><span class="user_num">结算账号：<i>'+userNo+'</i></span></p><p><span>开号日期：'+becomeBrokerDate+'</span><span>手机号码：'+phone+'</span></p><p><span>开户总量：'+accountOpenCount+'</span><span>签约总量：'+accountSignCount+'</span></p><p><span>交易总量：'+tradingVolume+'</span><span>钻石VIP：'+diamondVipCount+'</span></p><p><span>&nbsp;</span></p><b class="level_one vip" onclick="window.location= \'vip.html?brokerUserNo='+brokerUserNo+'\'">查看钻石VIP</b><b class="level_one" onclick="window.location= \'first_level.html?pic='+brokerUserNo+'\'">一级经纪商</b></div>';

     			                return html;
     		                }

     		                $(data.data.brokerList).each(function(i){
     		                	var listHtml = detailedListHtml(this.name,this.brokerUserName,this.brokerUserNo,this.userNo,this.becomeBrokerDate,this.phone,this.accountOpenCount,this.accountSignCount,this.tradingVolume,this.diamondVipCount);
     		                	itemListHtml += listHtml;
     		                })

     		                if(data.data.brokerList == ''){
     		                    $('#itemList').html(emptyHtml);
     		                }else{
     		                	$('#itemList').html(itemListHtml);
     		                } 

                      	} else if (state > "error") {
                          
                      	} else if (state < "noSession") {
                          	window.location.href = "login.html";
                     	}
                  }
              })
            })


            // 分页
            $(window).scroll(function(){

    			var wh=$("#detailed_list").height();
    	        var s= wh - $(window).scrollTop() - $(window).height();
    	        if(s < 10 ){
    	        	page++;
    	        	// alert(totalPage +"---"+page)
    	        	if(totalPage > page){
    	        		$(".loader_cover_box").css("display","block");
    			  		var session_token = $.cookie('session_token');
    			  		var brokerUserNo = $("#searchInfo").val();
    			  		var pageIndex = page;
    			        app.ajaxHelper.submitRequest({
    			            url: '/api/listBrokerUserAdvance',
    			            data: {
    			                session_token: session_token,
    			                pageIndex: pageIndex,
    			                brokerUserNo: brokerUserNo
    			            },
    			            success: function (data) {
    			                var state = data.result;
    			                var emptyHtml = '<div class="empty_data"><div class="empty"></div></div>';
    			                if (state == "success") {
    			         			totalPage == data.data.paging.totalPage;
    		                   		$(".loader_cover_box").css("display","none");
    		                   		$("#supervisorName").html(data.data.supervisorName);

    		       	                function detailedListHtml(name,brokerUserName,brokerUserNo,userNo,becomeBrokerDate,phone,accountOpenCount,accountSignCount,tradingVolume,diamondVipCount) {

    		       		                var html = '<div class="item"><b class="d_grade senior"></b><p class="user_ifon"><i class="user_name">'+name+'</i><i class="user_adderss">'+brokerUserName+'</i></p><p><span class="user_account">经纪商账号：<i>'+brokerUserNo+'</i></span><span class="user_num">结算账号：<i>'+userNo+'</i></span></p><p><span>开号日期：'+becomeBrokerDate+'</span><span>手机号码：'+phone+'</span></p><p><span>开户总量：'+accountOpenCount+'</span><span>签约总量：'+accountSignCount+'</span></p><p><span>交易总量：'+tradingVolume+'</span><span>钻石VIP：'+diamondVipCount+'</span></p><p><span>&nbsp;</span></p><b class="level_one vip" onclick="window.location= \'vip.html?brokerUserNo='+brokerUserNo+'\'">查看钻石VIP</b><b class="level_one" onclick="window.location= \'first_level.html?pic='+brokerUserNo+'\'">一级经纪商</b></div>';

    		       		                return html;
    		       	                }

    		       	                $(data.data.brokerList).each(function(i){
    		       	                	var listHtml = detailedListHtml(this.name,this.brokerUserName,this.brokerUserNo,this.userNo,this.becomeBrokerDate,this.phone,this.accountOpenCount,this.accountSignCount,this.tradingVolume,this.diamondVipCount);
    		       	                	$('#itemList').append(listHtml);
    		       	                })

    			                } else if (state > "error") {
    			                    $('#itemList').html(emptyHtml)
    			                } else if (state < "noSession") {
    			                    window.location.href = "login.html";
    			                }
    			            }
    			        })
    	        	}
    		  		

    	        }
            });
            
	        $(".loader_cover_box").on('touchmove', function(event) {
				event.preventDefault();
			});
		});   
	</script>
</body>
</html>