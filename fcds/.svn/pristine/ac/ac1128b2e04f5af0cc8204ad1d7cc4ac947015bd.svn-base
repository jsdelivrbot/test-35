<template>
  <div id="uncommitted">
    <div class="item" v-for="item in noCommitList">
      <p class="user_ifon">
        <i class="user_name">{{item.tradeUserName}}</i><i class="user_adderss">{{item.brokerUserName}}</i><b class="modify" @click="modify(item.tradeUserName, item.tradeUserNo,item.placingQuantity, item.productId, item.placingId)"></b><b class="delete" @click="deleted(item.placingId)"></b>
      </p>
      <p>
        <span class="user_account">账号：<i>{{item.tradeUserNo}}</i></span><span class="user_num">数量（块）：<i>{{item.placingQuantity}}</i></span>
      </p>
      <p>
        <span>日期：{{item.createDate}}</span><span>金额（元）：{{item.money}}</span>
      </p>
      <p>
        <span>状态：{{item.status}}</span><span>备注：{{item.comments}}</span>
      </p>
      <p>
        <span v-if="test(item.placingAgent)">配售员：{{item.placingAgent}}</span></span>
      </p>
    </div>
    <v-empty v-show="emptySta"></v-empty>

    <div class="stage-cover" v-show="coverShow"></div>

    <div class="modifyCovers" v-show="coverShow">
      <div class="modifyCoverInner" v-show="modifysta">
        <ul>
          <li><span>交易商姓名：{{curtradeUserName}}</span></li>
          <li><span>交易商账号：{{curtradeUserNo}}</span></li>
          <li><span>配售数量：{{curplacingQuantity}}块</span></li>
          <li><span>修改数量：</span><input type="text" placeholder="请输入数量" v-model='user_num'></li>
        </ul>
        <div class="determine" @click="modifyNum">确认修改</div>
      </div>
      <span class="close" @click="close"><img src="../../../../../assets/close_03.png"></span>
      <!-- 删除 -->
      <div class="modifyCoverInner" v-show="modifyDe">
         <div class="determine determineDelete" @click="modifyde">删除</div>
      </div>

    </div>
  </div>
</template>

<script>
import empty from 'components/empty/empty';
const ERR_OK = 'success';

  export default{
    components:{
      'v-empty': empty
    },
    data(){
      return{
        noCommitList: {},
        emptySta: false,
        coverShow: false,
        modifysta: false,
        modifyDe: false,
        curtradeUserName: null,
        curtradeUserNo: null,
        curplacingQuantity: null,
        user_num: null,
        productId: null,
        placingId: null,
        type: null,
        sessionToken: localStorage.getItem("sessionToken"),
      }
    },
    created() {
	   this.noCommitList = this.$route.query.noCommitList;
     localStorage.setItem('sellroute', 'uncommitted');
    },
    methods:{
      modify: function(tradeUserName,tradeUserNo,placingQuantity,productId,placingId){
        this.user_num = null;
        this.coverShow = true;
        this.modifysta = true;
        this.modifyDe = false;
        this.curtradeUserName = tradeUserName;
        this.curtradeUserNo = tradeUserNo;
        this.curplacingQuantity = placingQuantity;
        this.productId = productId;
        this.placingId = placingId;
        this.type = 'update';
      },
      close: function(){
        this.coverShow = false;
        this.modifysta = false;
        this.modifyDe = false;
      },
      deleted: function(placingId){
        this.coverShow = true;
        this.modifysta = false;
        this.modifyDe = true;
        this.placingId = placingId;
        this.type = 'delete';
      },
      modifyNum: function(){
        this.coverShow = false;
        this.modifysta = false;
        this.modifyDe = false;
        this.updatePlacing(this.productId,this.placingId,this.curtradeUserNo,this.curtradeUserName,this.user_num,this.type,this.sessionToken);
      },
      updatePlacing: function(productId,placingId,tradeUserNo,tradeUserName,placingNum,type,sessionToken){
        this.$http.get('/api/updatePlacing?',{params:{productId: productId, placingId: placingId, tradeUserNo: tradeUserNo,tradeUserName:tradeUserName,placingNum: placingNum,type: type,sessionToken: sessionToken}}).then((response) => { 
          if(response.body.result == ERR_OK){ 
            alert('成功')
            this.$router.replace({ path: '/emptydata' })
          }else{
            // this.$refs.timerbtn.stop();
            alert('失败')
          }
          
        }).then((error)=> this.error = error)
      },
      deletePlacing: function(placingId,type,sessionToken){
        this.$http.get('/api/updatePlacing?',{params:{placingId: placingId,type: type,sessionToken: sessionToken}}).then((response) => { 
          if(response.body.result == ERR_OK){ 
            alert('成功')
            this.$router.replace({ path: '/emptydata' })
          }else{
            // this.$refs.timerbtn.stop();
            alert('失败')
          }
          
        }).then((error)=> this.error = error)
      },
      modifyde: function(){
        this.coverShow = false;
        this.modifysta = false;
        this.modifyDe = false;
        this.deletePlacing(this.placingId, this.type, this.sessionToken);
      },
      test: function(placingAgent){
        var result;
        if(placingAgent == ''){
          result = false
        }else{
          result = true
        }
        return result;
      }
    },
    mounted(){
      if (this.noCommitList == null) {
         this.emptySta = true
       }else{
         this.emptySta = false
       }
    }
  };
</script>

<style lang="stylus" rel="stylesheet/stylus">
  .modifyCovers
    position: fixed
    top: 50%
    left: 50%
    width: 2.9rem
    min-height: 1.88rem
    background-color: #fff
    z-index: 100000002
    transform: translateX(-50%) translateY(-50%)
    border-radius: 3px
    box-shadow: 0 0 30px 0 rgba(0, 0, 0, 0.4)
    .modifyCoverInner
      padding: 0.25rem 0.45rem 0.2rem 0.35rem
      .determine
        margin: 0.25rem auto 0 auto
        width: 1.35rem
        height: 0.35rem
        background-color: #ff6000
        border-radius: 0.2rem
        text-align: center
        color: #fff
        font-size: 0.14rem
        line-height: 0.35rem
      li
        position: relative
        height: 0.26rem
        line-height: 0.26rem
        margin-top: 0.15rem
        padding-left: 0.75rem
        &:nth-last-child(1)
          border-bottom: 1px solid #ff6000
        span
          position: absolute
          top: 0
          left: 0
          font-size: 0.14rem
          color: #333333
        input
          outline: none
          font-size: 0.14rem
    .close
      position: absolute
      top: -0.08rem
      right: -0.08rem
      width: 0.28rem
      height: 0.28rem
      img
        display: block
        width: 100%
        height: 100%
  #uncommitted
    .item
      margin-top: 0.1rem
      padding: 0.1rem
      width: 100%
      min-height: 1.38rem
      background-color: #fff
      p
        font-size: 0.14rem
        &.user_ifon
          position: relative
          margin-bottom: 0.1rem
          .user_name
            color: #333
            font-style: normal
            font-size: 0.2rem
          .user_adderss
            padding-left: 0.12rem
            color: #666
            font-style: normal
            font-size: 0.12rem
          .modify
            display: block
            position: absolute
            top: 0
            right: 0.25rem
            color: #54b9ff
            font-size: 0.13rem
            font-weight: normal
            cursor: pointer
            &::after
              position: absolute
              top: -0.01rem
              left: -0.18rem
              display: block
              width: 0.15rem
              height: 0.15rem;
              background: url(../../../../../assets/modify_03.png) 0 0 no-repeat
              background-size: 100%
              content: ''
              -webkit-background-size: 100%
          .delete
            display: block
            position: absolute
            top: 0
            right: 0
            color: #54b9ff
            font-size: 0.13rem
            font-weight: normal
            cursor: pointer
            &::after
              position: absolute
              top: -0.01rem
              left: -0.18rem
              display: block
              width: 0.15rem
              height: 0.15rem;
              background: url(../../../../../assets/delete.png) 0 0 no-repeat
              background-size: 100%
              content: ''
              -webkit-background-size: 100%
        span
          display: inline-block
          width: 50%
          color: #666
          font-size: 0.14rem
          line-height: 0.3rem
          i
            font-style: normal
</style>
